<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LIBS: upgrade_partitions.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LIBS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d6/dec/upgrade__partitions_8c.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">upgrade_partitions.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;ps.h&gt;</code><br />
<code>#include &lt;<a class="el" href="../../d5/d77/print_8h_source.html">print.h</a>&gt;</code><br />
<code>#include &lt;partition.h&gt;</code><br />
<code>#include &lt;sink.h&gt;</code><br />
<code>#include &lt;stream.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../d1/d27/upgrade__private_8h_source.html">upgrade_private.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../db/d0e/upgrade__ctx_8h_source.html">upgrade_ctx.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d1/d1d/upgrade__psstore_8h_source.html">upgrade_psstore.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d0/d07/upgrade__partitions_8h_source.html">upgrade_partitions.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adb1192ef9d2f81e8dc886757c73d6f19"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dec/upgrade__partitions_8c.html#adb1192ef9d2f81e8dc886757c73d6f19">UpgradePartitionsSetMappingTable</a> (const <a class="el" href="../../d8/d31/structUPGRADE__UPGRADABLE__PARTITION__T.html">UPGRADE_UPGRADABLE_PARTITION_T</a> *table, uint16 entries)</td></tr>
<tr class="memdesc:adb1192ef9d2f81e8dc886757c73d6f19"><td class="mdescLeft">&#160;</td><td class="mdescRight">UpgradePartitionsSetMappingTable - set table to map logical to physical.  <a href="#adb1192ef9d2f81e8dc886757c73d6f19">More...</a><br /></td></tr>
<tr class="separator:adb1192ef9d2f81e8dc886757c73d6f19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0bda8b6077dbc3eb2151ca172cd7ac7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d07/upgrade__partitions_8h.html#a681775d589567d027c506f26b82b9fa7">UpgradePartitionID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dec/upgrade__partitions_8c.html#ac0bda8b6077dbc3eb2151ca172cd7ac7">UpgradePartitionsPhysicalPartition</a> (uint16 logicalPartition, <a class="el" href="../../d0/d07/upgrade__partitions_8h.html#ae4ed2a63b86f62497751ae9a4890ae4f">UpgradePartitionGetPhysicalType</a> request)</td></tr>
<tr class="memdesc:ac0bda8b6077dbc3eb2151ca172cd7ac7"><td class="mdescLeft">&#160;</td><td class="mdescRight">UpgradePartitionsPhysicalPartition - get physical partition for logical.  <a href="#ac0bda8b6077dbc3eb2151ca172cd7ac7">More...</a><br /></td></tr>
<tr class="separator:ac0bda8b6077dbc3eb2151ca172cd7ac7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a628c688dc58c749007c711706a7ff645"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d07/upgrade__partitions_8h.html#a681775d589567d027c506f26b82b9fa7">UpgradePartitionID</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dec/upgrade__partitions_8c.html#a628c688dc58c749007c711706a7ff645">UpgradePartitionsNewPhysical</a> (<a class="el" href="../../d0/d07/upgrade__partitions_8h.html#a681775d589567d027c506f26b82b9fa7">UpgradePartitionID</a> currentPartition)</td></tr>
<tr class="memdesc:a628c688dc58c749007c711706a7ff645"><td class="mdescLeft">&#160;</td><td class="mdescRight">UpgradePartitionsNewPhysical.  <a href="#a628c688dc58c749007c711706a7ff645">More...</a><br /></td></tr>
<tr class="separator:a628c688dc58c749007c711706a7ff645"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a252467bc53cc86f00eb50f7947ac6f96"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dec/upgrade__partitions_8c.html#a252467bc53cc86f00eb50f7947ac6f96">UpgradePartitionsUpgradeStarted</a> (void)</td></tr>
<tr class="memdesc:a252467bc53cc86f00eb50f7947ac6f96"><td class="mdescLeft">&#160;</td><td class="mdescRight">UpgradePartitionsUpgradeStarted - update copy of boot state of device.  <a href="#a252467bc53cc86f00eb50f7947ac6f96">More...</a><br /></td></tr>
<tr class="separator:a252467bc53cc86f00eb50f7947ac6f96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3027592f3835c6aa1c85ff11cc2ee22d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dec/upgrade__partitions_8c.html#a3027592f3835c6aa1c85ff11cc2ee22d">UpgradePartitionsCommitUpgrade</a> (void)</td></tr>
<tr class="memdesc:a3027592f3835c6aa1c85ff11cc2ee22d"><td class="mdescLeft">&#160;</td><td class="mdescRight">UpgradePartitionsCommitUpgrade - update partition status.  <a href="#a3027592f3835c6aa1c85ff11cc2ee22d">More...</a><br /></td></tr>
<tr class="separator:a3027592f3835c6aa1c85ff11cc2ee22d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a909a2bbcd02a32983d41290b866e07b9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dec/upgrade__partitions_8c.html#a909a2bbcd02a32983d41290b866e07b9">UpgradePartitionsMarkUpgrading</a> (uint16 logicalPartition)</td></tr>
<tr class="memdesc:a909a2bbcd02a32983d41290b866e07b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">UpgradePartitionsMarkUpgrading - Mark a logical partition as being upgraded.  <a href="#a909a2bbcd02a32983d41290b866e07b9">More...</a><br /></td></tr>
<tr class="separator:a909a2bbcd02a32983d41290b866e07b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><dl class="section user"><dt></dt><dd></dd></dl>
<dl class="section user"><dt>DESCRIPTION</dt><dd>Implementation of partition management, dealing with the realities of mapping logical to physical partitions, tracking double banking, and also erase state.</dd></dl>
<dl class="section user"><dt>IMPLEMENTATION NOTES</dt><dd>Mapping of logical to physical partition is provided as a table <a class="el" href="../../d8/d31/structUPGRADE__UPGRADABLE__PARTITION__T.html" title="Element defining the physical partitions in flash that apply to this logical partition. ">UPGRADE_UPGRADABLE_PARTITION_T</a> provided by the VM app at runtime. We make the pointer to this static and provide all the access. </dd></dl>
<dl class="section user"><dt></dt><dd>The status of partitions comes from a PSKEY. </dd></dl>
<dl class="section user"><dt></dt><dd>When first booted we expect the relevant words to be non-existent and the PSSTORE module deals with initialising these. The ORIGINAL state is held in the PSSTORE module in the copy of the PSKEY. <br />
The FUTURE state is held in the same place, but is never written back by this module. The key is being written by the upgrade process at the appropriate moments to ensure that the FUTURE will be saved. </dd></dl>
<dl class="section user"><dt></dt><dd>APIs are provided to start/resume an upgrade mark a partition as affected by upgrade commit an upgrade</dd></dl>
<dl class="section user"><dt></dt><dd>@todo When we have rebooted for commit... what partitions should we return? The app may be asking for Raw Serials... </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a3027592f3835c6aa1c85ff11cc2ee22d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3027592f3835c6aa1c85ff11cc2ee22d">&#9670;&nbsp;</a></span>UpgradePartitionsCommitUpgrade()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UpgradePartitionsCommitUpgrade </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>UpgradePartitionsCommitUpgrade - update partition status. </p>
<p>UpgradePartitionsCommitUpgrade.</p>
<dl class="section user"><dt>DESCRIPTION</dt><dd>We've been told to commit an upgrade. Update the partition status. Do NOT write back the PSKEY, but rely on our caller to do so. </dd></dl>

</div>
</div>
<a id="a909a2bbcd02a32983d41290b866e07b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a909a2bbcd02a32983d41290b866e07b9">&#9670;&nbsp;</a></span>UpgradePartitionsMarkUpgrading()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UpgradePartitionsMarkUpgrading </td>
          <td>(</td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>logicalPartition</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>UpgradePartitionsMarkUpgrading - Mark a logical partition as being upgraded. </p>
<p>UpgradePartitionsMarkUpgrading.</p>
<dl class="section user"><dt>DESCRIPTION</dt><dd>Toggle the bank, or mark partition as dirty. </dd></dl>

</div>
</div>
<a id="a628c688dc58c749007c711706a7ff645"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a628c688dc58c749007c711706a7ff645">&#9670;&nbsp;</a></span>UpgradePartitionsNewPhysical()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d07/upgrade__partitions_8h.html#a681775d589567d027c506f26b82b9fa7">UpgradePartitionID</a> UpgradePartitionsNewPhysical </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d0/d07/upgrade__partitions_8h.html#a681775d589567d027c506f26b82b9fa7">UpgradePartitionID</a>&#160;</td>
          <td class="paramname"><em>currentPartition</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>UpgradePartitionsNewPhysical. </p>
<dl class="section user"><dt>DESCRIPTION</dt><dd>Given a physical partition returns the matching, upgraded, partition ID. </dd></dl>
<dl class="section user"><dt></dt><dd>Scans our partition mapping table for a match. Checks every logical partition using existing function. </dd></dl>

</div>
</div>
<a id="ac0bda8b6077dbc3eb2151ca172cd7ac7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0bda8b6077dbc3eb2151ca172cd7ac7">&#9670;&nbsp;</a></span>UpgradePartitionsPhysicalPartition()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d0/d07/upgrade__partitions_8h.html#a681775d589567d027c506f26b82b9fa7">UpgradePartitionID</a> UpgradePartitionsPhysicalPartition </td>
          <td>(</td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>logicalPartition</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d07/upgrade__partitions_8h.html#ae4ed2a63b86f62497751ae9a4890ae4f">UpgradePartitionGetPhysicalType</a>&#160;</td>
          <td class="paramname"><em>request</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>UpgradePartitionsPhysicalPartition - get physical partition for logical. </p>
<p>UpgradePartitionsPhysicalPartition.</p>
<dl class="section user"><dt>DESCRIPTION</dt><dd>Given a logical partition number, interrogates the logical partition table based on the currently mapped partition and returns the requested bank. </dd></dl>
<dl class="section user"><dt></dt><dd></dd></dl>

</div>
</div>
<a id="adb1192ef9d2f81e8dc886757c73d6f19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb1192ef9d2f81e8dc886757c73d6f19">&#9670;&nbsp;</a></span>UpgradePartitionsSetMappingTable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool UpgradePartitionsSetMappingTable </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d8/d31/structUPGRADE__UPGRADABLE__PARTITION__T.html">UPGRADE_UPGRADABLE_PARTITION_T</a> *&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>entries</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>UpgradePartitionsSetMappingTable - set table to map logical to physical. </p>
<p>UpgradePartitionsSetMappingTable.</p>
<dl class="section user"><dt>DESCRIPTION</dt><dd>Accept details of a partition mapping table. Check for validity and store if legal. </dd></dl>
<dl class="section user"><dt></dt><dd></dd></dl>
<dl class="section return"><dt>Returns</dt><dd>TRUE if table supplied, and table is a valid length. FALSE otherwise. </dd></dl>
<dl class="section user"><dt></dt><dd></dd></dl>

</div>
</div>
<a id="a252467bc53cc86f00eb50f7947ac6f96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a252467bc53cc86f00eb50f7947ac6f96">&#9670;&nbsp;</a></span>UpgradePartitionsUpgradeStarted()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UpgradePartitionsUpgradeStarted </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>UpgradePartitionsUpgradeStarted - update copy of boot state of device. </p>
<p>UpgradePartitionsUpgradeStarted.</p>
<dl class="section user"><dt>DESCRIPTION</dt><dd>We've been told that a new, or resumed, upgrade is starting. Reset our "future" partition status. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.14-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_9104b11b055a08855e18ab07d1360a34.html">apps_ext_adk64r_RC_CI_qcc512x_qcc302x_1908091004</a></li><li class="navelem"><a class="el" href="../../dir_19c4644e84b768df42bf93899dbb4e83.html">apps_package</a></li><li class="navelem"><a class="el" href="../../dir_e9f51238b5eab91050ba7b42263dc658.html">progfiles</a></li><li class="navelem"><a class="el" href="../../dir_86fefe393b7ca9a63838560cf4ca04cf.html">apps</a></li><li class="navelem"><a class="el" href="../../dir_4741f709c1c589b2cd57d229d2794b05.html">libs</a></li><li class="navelem"><a class="el" href="../../dir_e4826ee8ae7389fdbf679a5c41d02724.html">upgrade</a></li><li class="navelem"><a class="el" href="../../d6/dec/upgrade__partitions_8c.html">upgrade_partitions.c</a></li>
    <li class="footer">Copyright (c) 2019 Qualcomm Technologies International, Ltd. Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
